<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <title>Generator link feedback KFC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="https://kfclistenscx.qualtrics.com/CP/Graphic.php?IM=IM_dbC1Qsmkf9X2Bmu">
  <style>
    :root {
      --kfc-red: #e4002b;
      --kfc-dark: #1d1d1d;
      --kfc-light: #fefefe;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--kfc-light);
      color: var(--kfc-dark);
    }

    header {
      background-color: var(--kfc-light);
      padding: 10px 20px;
      display: flex;
      align-items: center;
      border-bottom: 4px solid var(--kfc-red);
    }

    header img {
      height: 50px;
      margin-right: 15px;
    }

    header h1 {
      font-size: 20px;
      margin: 0;
      color: var(--kfc-red);
    }

    main {
      max-width: 650px;
      margin: 20px auto;
      padding: 20px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    h2 {
      text-align: center;
      color: var(--kfc-dark);
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }

    input[type="text"],
    input[type="date"],
    input[type="time"],
    input[type="number"],
    button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    button {
      background-color: var(--kfc-red);
      color: white;
      border: none;
      cursor: pointer;
      margin-top: 15px;
    }

    button:hover {
      background-color: #c30024;
    }

    .link-container {
      margin-top: 20px;
    }

    .link-box {
      background: #fafafa;
      padding: 10px;
      border: 1px solid #ddd;
      margin-bottom: 10px;
      border-radius: 5px;
    }

    .link-box a {
      display: block;
      color: var(--kfc-red);
      font-weight: bold;
      margin-bottom: 5px;
      word-break: break-word;
    }

    .link-box button {
      width: 48%;
      display: inline-block;
      margin-right: 2%;
      background-color: var(--kfc-dark);
    }

    .proxy-container {
      margin-top: 30px;
      text-align: center;
    }

    .proxy-container button {
      width: 48%;
      margin: 5px 1%;
      background-color: #555;
    }

    #qr-scanner {
      display: none;
      width: 100%;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<header>
  <img src="https://kfclistenscx.qualtrics.com/CP/Graphic.php?IM=IM_dbC1Qsmkf9X2Bmu" alt="KFC Logo">
  <h1>Generator link feedback KFC</h1>
</header>

<main>
  <h2>GenereazÄƒ linkuri pentru feedback</h2>

  <label>1. ScaneazÄƒ QR sau Ã®ncarcÄƒ o imagine:</label>
  <button onclick="startQRScanner()">ğŸ“· CamerÄƒ</button>
  <input type="file" id="imageInput" accept="image/*">
  <div id="qr-scanner"></div>

  <label>2. Link din QR:</label>
  <input type="text" id="scannedResult" placeholder="Aici apare linkul scanat">

  <label>3. DatÄƒ (implicit astÄƒzi):</label>
  <input type="date" id="selectedDate">

  <label>4. Ora de Ã®nceput:</label>
  <input type="time" id="startTime">

  <label>5. Ora de sfÃ¢rÈ™it:</label>
  <input type="time" id="endTime">

  <label>6. CÃ¢te linkuri sÄƒ se genereze:</label>
  <input type="number" id="linkCount" value="10">

  <button onclick="generateLinks()">ğŸ”— GenereazÄƒ linkuri</button>

  <div id="links" class="link-container"></div>

  <div class="proxy-container">
    <button onclick="window.open('https://proxyium.com', '_blank')">ğŸŒ Deschide Proxyium</button>
    <button onclick="window.open('https://www.croxyproxy.com', '_blank')">ğŸŒ Deschide CroxyProxy</button>
  </div>
</main>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
  let html5QrCode;

  function setDefaultDateTime() {
    const now = new Date();
    document.getElementById("selectedDate").valueAsDate = now;
    document.getElementById("startTime").value = "10:00";
    document.getElementById("endTime").value = now.toTimeString().slice(0, 5);
  }

  function startQRScanner() {
    const scannerDiv = document.getElementById("qr-scanner");
    scannerDiv.style.display = "block";
    html5QrCode = new Html5Qrcode("qr-scanner");
    html5QrCode.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      qrCodeSuccess
    ).catch(err => alert("Eroare camerÄƒ: " + err));
  }

  function qrCodeSuccess(decodedText) {
    document.getElementById("scannedResult").value = decodedText;
    html5QrCode.stop().then(() => {
      document.getElementById("qr-scanner").style.display = "none";
    });
  }

  document.getElementById("imageInput").addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;
    const qr = new Html5Qrcode("qr-scanner");
    qr.scanFile(file, true).then(decodedText => {
      document.getElementById("scannedResult").value = decodedText;
    }).catch(() => alert("QR nu a fost gÄƒsit Ã®n imagine"));
  });

  function parseLinkData(link) {
    const url = new URL(link);
    const params = new URLSearchParams(url.search);
    return {
      S: params.get("S"),
      dateTime: decodeURIComponent(params.get("D")),
      TI: parseInt(params.get("TI")),
      lang: params.get("Q_Language") || "RO"
    };
  }

  function generateLinks() {
    const link = document.getElementById("scannedResult").value.trim();
    const date = document.getElementById("selectedDate").value;
    const startTime = document.getElementById("startTime").value;
    const endTime = document.getElementById("endTime").value;
    const count = parseInt(document.getElementById("linkCount").value);

    if (!link || !date || !startTime || !endTime || !count) {
      alert("CompleteazÄƒ toate cÃ¢mpurile!");
      return;
    }

    const data = parseLinkData(link);
    const base = "https://customer.kfc-listens.com/jfe/form/SV_7WmLtfIDJuM3Vn8";
    const start = new Date(`${date}T${startTime}`);
    const end = new Date(`${date}T${endTime}`);
    const now = new Date();

    if (end < start) {
      alert("Ora de sfÃ¢rÈ™it nu poate fi Ã®naintea celei de Ã®nceput!");
      return;
    }
    if (end > now) {
      alert("Ora de sfÃ¢rÈ™it nu poate fi Ã®n viitor!");
      return;
    }

    const diff = (end - start) / count;
    let linksHTML = "";

    for (let i = 0; i < count; i++) {
      const ti = data.TI - (count - i - 1);
      const time = new Date(start.getTime() + diff * i);
      const dd = String(time.getDate()).padStart(2, "0");
      const mm = String(time.getMonth() + 1).padStart(2, "0");
      const yyyy = time.getFullYear();
      const hh = String(time.getHours()).padStart(2, "0");
      const mi = String(time.getMinutes()).padStart(2, "0");

      const encodedDateTime = encodeURIComponent(`${dd}/${mm}/${yyyy}%20${hh}:${mi}`);
      const fullLink = `${base}?S=${data.S}&D=${encodedDateTime}&TI=${ti}&Q_Language=${data.lang}`;

      linksHTML += `<div class="link-box">
        <a href="${fullLink}" target="_blank">${fullLink}</a>
        <button onclick="navigator.clipboard.writeText('${fullLink}'); alert('Copiat!')">ğŸ“‹ CopiazÄƒ</button>
        <button onclick="window.open('${fullLink}', '_blank')">ğŸ”“ Deschide</button>
      </div>`;
    }

    document.getElementById("links").innerHTML = linksHTML;
  }

  setDefaultDateTime();
</script>
</body>
</html>
