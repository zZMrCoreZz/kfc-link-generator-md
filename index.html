<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <title>KFC QR Link Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; background: #f4f4f4; margin: 20px; }
    h2 { text-align: center; }
    input, select, button { width: 100%; padding: 10px; margin-bottom: 15px; font-size: 16px; }
    #qr-scanner { width: 100%; margin-bottom: 15px; display: none; }
    #links div { background: #fff; padding: 10px; margin-bottom: 5px; border: 1px solid #ccc; border-radius: 5px; }
    .copy-btn, .open-btn, .proxy-btn {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 8px;
      margin-top: 5px;
      cursor: pointer;
      width: 48%;
      display: inline-block;
    }
    .proxy-container {
      text-align: center;
      margin-top: 20px;
    }
    .proxy-container button {
      width: 48%;
      margin: 5px 1%;
    }
  </style>
</head>
<body>

<h2>üì≤ KFC QR Link Generator</h2>

<label>1. –°–∫–∞–Ω–∏—Ä—É–π QR –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</label>
<button onclick="startQRScanner()">üì∑ –ö–∞–º–µ—Ä–∞</button>
<input type="file" id="imageInput" accept="image/*">
<div id="qr-scanner"></div>

<label>2. –°—Å—ã–ª–∫–∞ –∏–∑ QR:</label>
<input type="text" id="scannedResult" placeholder="–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å">

<label>3. –î–∞—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ–≥–æ–¥–Ω—è):</label>
<input type="date" id="selectedDate">

<label>4. –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10:00):</label>
<input type="time" id="startTime">

<label>5. –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ–π—á–∞—Å):</label>
<input type="time" id="endTime">

<label>6. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Å—ã–ª–æ–∫ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:</label>
<input type="number" id="linkCount" value="10">

<button onclick="generateLinks()">üîó –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫–∏</button>

<h3>–°—Å—ã–ª–∫–∏:</h3>
<div id="links"></div>

<div class="proxy-container">
  <button class="proxy-btn" onclick="window.open('https://proxyium.com', '_blank')">üîì Proxyium</button>
  <button class="proxy-btn" onclick="window.open('https://www.croxyproxy.com', '_blank')">üîì CroxyProxy</button>
</div>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
  let html5QrCode;

  function setDefaultDateTime() {
    const now = new Date();
    document.getElementById("selectedDate").valueAsDate = now;
    document.getElementById("startTime").value = "10:00";
    document.getElementById("endTime").value = now.toTimeString().slice(0, 5);
  }

  function startQRScanner() {
    const scannerDiv = document.getElementById("qr-scanner");
    scannerDiv.style.display = "block";
    html5QrCode = new Html5Qrcode("qr-scanner");
    html5QrCode.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      qrCodeSuccess
    ).catch(err => alert("–û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã: " + err));
  }

  function qrCodeSuccess(decodedText) {
    document.getElementById("scannedResult").value = decodedText;
    html5QrCode.stop().then(() => {
      document.getElementById("qr-scanner").style.display = "none";
    });
  }

  document.getElementById("imageInput").addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;
    const qr = new Html5Qrcode("qr-scanner");
    qr.scanFile(file, true).then(decodedText => {
      document.getElementById("scannedResult").value = decodedText;
    }).catch(() => alert("QR –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏"));
  });

  function parseLinkData(link) {
    const url = new URL(link);
    const params = new URLSearchParams(url.search);
    return {
      S: params.get("S"),
      dateTime: decodeURIComponent(params.get("D")),
      TI: parseInt(params.get("TI")),
      lang: params.get("Q_Language") || "RO"
    };
  }

  function generateLinks() {
    const link = document.getElementById("scannedResult").value.trim();
    const date = document.getElementById("selectedDate").value;
    const startTime = document.getElementById("startTime").value;
    const endTime = document.getElementById("endTime").value;
    const count = parseInt(document.getElementById("linkCount").value);

    if (!link || !date || !startTime || !endTime || !count) {
      alert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è!");
      return;
    }

    const data = parseLinkData(link);
    const base = "https://customer.kfc-listens.com/jfe/form/SV_7WmLtfIDJuM3Vn8";
    const start = new Date(`${date}T${startTime}`);
    const end = new Date(`${date}T${endTime}`);
    const now = new Date();

    if (end < start) {
      alert("–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –Ω–∞—á–∞–ª–∞!");
      return;
    }
    if (end > now) {
      alert("–í—Ä–µ–º—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑ –±—É–¥—É—â–µ–≥–æ!");
      return;
    }

    const diff = (end - start) / count;
    let linksHTML = "";

    for (let i = 0; i < count; i++) {
      const ti = data.TI - (count - i - 1);
      const time = new Date(start.getTime() + diff * i);
      const dd = String(time.getDate()).padStart(2, "0");
      const mm = String(time.getMonth() + 1).padStart(2, "0");
      const yyyy = time.getFullYear();
      const hh = String(time.getHours()).padStart(2, "0");
      const mi = String(time.getMinutes()).padStart(2, "0");

      const encodedDateTime = encodeURIComponent(`${dd}/${mm}/${yyyy}%20${hh}:${mi}`);
      const fullLink = `${base}?S=${data.S}&D=${encodedDateTime}&TI=${ti}&Q_Language=${data.lang}`;

      linksHTML += `<div>
        <a href="${fullLink}" target="_blank">${fullLink}</a><br>
        <button class="copy-btn" onclick="copyLink('${fullLink}')">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        <button class="open-btn" onclick="window.open('${fullLink}', '_blank')">üîì –û—Ç–∫—Ä—ã—Ç—å</button>
      </div>`;
    }

    document.getElementById("links").innerHTML = linksHTML;
  }

  function copyLink(text) {
    navigator.clipboard.writeText(decodeURIComponent(text))
      .then(() => alert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!"))
      .catch(() => alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å"));
  }

  setDefaultDateTime();
</script>

</body>
</html>
